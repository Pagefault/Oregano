/* This file is Auto generated, do not change it. Change the templete. */


#include <wdm.h>
#include "offsets.h"

windows_offsets offsets_for_versions[] = {
#ifdef AMD64
	/* ../windows_internals/ntosVersions\ntoskrnl_x64_5.2.3790.1830.exe */
	{
		{5, 2, 3790, 38},
		{0x188},
		{0x190, 0x178},
		{0x3e8, 0xb0, 0x414, 0x28, 0x370},
		{0x28, 0x290},
	},
	/* ../windows_internals/ntosVersions\ntoskrnl_x64_5.2.3790.3959.exe */
	{
		{5, 2, 3790, 119},
		{0x188},
		{0x190, 0x178},
		{0x3d0, 0xb0, 0x3fc, 0x28, 0x358},
		{0x28, 0x290},
	},
	/* ../windows_internals/ntosVersions\ntoskrnl_x64_5.2.3790.4045.exe */
	{
		{5, 2, 3790, 205},
		{0x188},
		{0x190, 0x178},
		{0x3d0, 0xb0, 0x3fc, 0x28, 0x358},
		{0x28, 0x290},
	},
	/* ../windows_internals/ntosVersions\ntoskrnl_x64_6.1.6002.18686.exe */
	{
		{6, 0, 6002, 254},
		{0x188},
		{0x190, 0x178},
		{0x3f0, 0xb0, 0x418, 0x28, 0x380},
		{0x28, 0x260},
	},
	/* ../windows_internals/ntosVersions\ntoskrnl_x64_6.1.7600.16385.exe */
	{
		{6, 1, 7600, 1},
		{0x188},
		{0x190, 0x178},
		{0x420, 0xb8, 0x448, 0x28, 0x3b0},
		{0x28, 0x308},
	},
	/* ../windows_internals/ntosVersions\ntoskrnl_x64_6.1.7600.16617.exe */
	{
		{6, 1, 7600, 233},
		{0x188},
		{0x190, 0x178},
		{0x420, 0xb8, 0x448, 0x28, 0x3b0},
		{0x28, 0x308},
	},
	/* ../windows_internals/ntosVersions\ntoskrnl_x64_6.1.7600.16841.exe */
	{
		{6, 1, 7600, 201},
		{0x188},
		{0x190, 0x178},
		{0x420, 0xb8, 0x448, 0x28, 0x3b0},
		{0x28, 0x308},
	},
	/* ../windows_internals/ntosVersions\ntoskrnl_x64_6.1.7601.17640.exe */
	{
		{6, 1, 7601, 232},
		{0x188},
		{0x190, 0x178},
		{0x420, 0xb8, 0x448, 0x28, 0x3b0},
		{0x28, 0x308},
	},
	/* ../windows_internals/ntosVersions\ntoskrnl_x64_6.1.7601.17944.exe */
	{
		{6, 1, 7601, 24},
		{0x124},
		{0x8c, 0x70},
		{0x268, 0x88, 0x280, 0x28, 0x22c},
		{0x18, 0x188},
	},
	/* ../windows_internals/ntosVersions\ntoskrnl_x64_6.2.9200.16461.exe */
	{
		{6, 2, 9200, 77},
		{0x188},
		{0x190, 0x178},
		{0x400, 0xf0, 0x42c, 0x28, 0x398},
		{0x28, 0x470},
	},

#else
	/* ../windows_internals/ntosVersions\ntoskrnl_x86_5.1.2600.3093.exe */
	{
		{5, 1, 2600, 21},
		{0x124},
		{0x29c, 0x70},
		{0x22c, 0x20, 0x248, 0x18, 0x1ec},
		{0x18, 0x190},
	},
	/* ../windows_internals/ntosVersions\ntoskrnl_x86_5.1.2600.5973.exe */
	{
		{5, 1, 2600, 85},
		{0x124},
		{0x29c, 0x70},
		{0x22c, 0x20, 0x248, 0x18, 0x1ec},
		{0x18, 0x190},
	},
	/* ../windows_internals/ntosVersions\ntoskrnl_x86_5.1.2600.6055.exe */
	{
		{5, 1, 2600, 167},
		{0x124},
		{0x29c, 0x70},
		{0x22c, 0x20, 0x248, 0x18, 0x1ec},
		{0x18, 0x190},
	},
	/* ../windows_internals/ntosVersions\ntoskrnl_x86_5.1.2600.6165.exe */
	{
		{5, 1, 2600, 21},
		{0x124},
		{0x29c, 0x70},
		{0x22c, 0x20, 0x248, 0x18, 0x1ec},
		{0x18, 0x190},
	},
	/* ../windows_internals/ntosVersions\ntoskrnl_x86_5.1.2600.6419.exe */
	{
		{5, 1, 2600, 19},
		{0x124},
		{0x29c, 0x70},
		{0x22c, 0x20, 0x248, 0x18, 0x1ec},
		{0x18, 0x190},
	},
	/* ../windows_internals/ntosVersions\ntoskrnl_x86_5.2.3790.4922.exe */
	{
		{5, 2, 3790, 58},
		{0x124},
		{0x29c, 0x70},
		{0x224, 0x74, 0x240, 0x18, 0x1e4},
		{0x18, 0x180},
	},
	/* ../windows_internals/ntosVersions\ntoskrnl_x86_5.2.3790.4998.exe */
	{
		{5, 2, 3790, 134},
		{0x124},
		{0x29c, 0x70},
		{0x224, 0x74, 0x240, 0x18, 0x1e4},
		{0x18, 0x180},
	},
	/* ../windows_internals/ntosVersions\ntoskrnl_x86_6.0.6002.18005.exe */
	{
		{6, 0, 6002, 85},
		{0x124},
		{0x29c, 0x70},
		{0x248, 0x84, 0x260, 0x28, 0x20c},
		{0x18, 0x168},
	},
	/* ../windows_internals/ntosVersions\ntoskrnl_x86_6.1.7600.16385.exe */
	{
		{6, 1, 7600, 1},
		{0x124},
		{0x29c, 0x70},
		{0x268, 0x88, 0x280, 0x28, 0x22c},
		{0x18, 0x188},
	},
	/* ../windows_internals/ntosVersions\ntoskrnl_x86_6.1.7600.16695.exe */
	{
		{6, 1, 7600, 55},
		{0x124},
		{0x29c, 0x70},
		{0x268, 0x88, 0x280, 0x28, 0x22c},
		{0x18, 0x188},
	},
	/* ../windows_internals/ntosVersions\ntoskrnl_x86_6.1.7600.16905.exe */
	{
		{6, 1, 7600, 9},
		{0x124},
		{0x29c, 0x70},
		{0x268, 0x88, 0x280, 0x28, 0x22c},
		{0x18, 0x188},
	},
	/* ../windows_internals/ntosVersions\ntoskrnl_x86_6.2.9200.16912.exe */
	{
		{6, 2, 9200, 16},
		{0x124},
		{0x29c, 0x70},
		{0x24c, 0xa8, 0x268, 0x20, 0x214},
		{0x18, 0x194},
	},
	/* ../windows_internals/ntosVersions\ntoskrnl_x86_WOW64_6.1.7600.16385.exe */
	{
		{6, 1, 7600, 1},
		{0x124},
		{0x29c, 0x70},
		{0x268, 0x88, 0x280, 0x28, 0x22c},
		{0x18, 0x188},
	},
	/* ../windows_internals/ntosVersions\ntoskrnl_x86_WOW64_6.1.7600.16841.exe */
	{
		{6, 1, 7600, 201},
		{0x124},
		{0x29c, 0x70},
		{0x268, 0x88, 0x280, 0x28, 0x22c},
		{0x18, 0x188},
	},
	/* ../windows_internals/ntosVersions\ntoskrnl_x86_WOW64_6.1.7601.17640.exe */
	{
		{6, 1, 7601, 232},
		{0x124},
		{0x29c, 0x70},
		{0x268, 0x88, 0x280, 0x28, 0x22c},
		{0x18, 0x188},
	},

#endif
    {
        {0, 0, 0, 0},
        {0},
        {0, 0},
        {0, 0, 0, 0},
        {0, 0},
    }
};

windows_offsets * find_windows_offsets(UINT32 * version)
{
    windows_offsets * offsets_iter  = offsets_for_versions;
    windows_offsets * most_fit      = offsets_for_versions;
    UINT32 current_delta = 0xffffffff;
    UINT32 temp_delta;
    for (
           offsets_iter = offsets_for_versions;
           (0 != offsets_iter->version[0]);
           ++offsets_iter ) {
        if (
                (offsets_iter->version[0] == version[0]) &&
                (offsets_iter->version[1] == version[1]) ) {

            if (version[2] > most_fit->version[2]) {
                temp_delta = version[2] - most_fit->version[2];
            } else {
                temp_delta = most_fit->version[2] - version[2];
            }
            if (temp_delta < current_delta) {
                most_fit = offsets_iter;
                current_delta = temp_delta;
            }
        }
    }
    if (current_delta > 0x100) {
        KdPrint(( "Oregano: find_windows_offsets: Failed to find matching offsets\r\n" ));
    } else {
        KdPrint(( "Oregano: find_windows_offsets: Using offsets of version %d %d %d %d\r\n",
                    most_fit->version[0],
                    most_fit->version[1],
                    most_fit->version[2],
                    most_fit->version[3] ));
    }
    return most_fit;
}

